<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKCV Mall - Smart Training</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .phone-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 8px solid #333;
            position: relative;
        }

        .header {
            background-color: #0084ff;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 2;
        }

        .progress-bar-container {
            background: #006acc;
            height: 6px;
            width: 100%;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #00ff88;
            width: 0%;
            transition: width 0.3s ease;
        }

        .chat-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #e4e6eb;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            animation: popIn 0.3s ease-out;
            position: relative;
            word-wrap: break-word;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.customer {
            background-color: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            color: #1c1e21;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message.you {
            background-color: #0084ff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .controls {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #ddd;
            z-index: 2;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background-color: #f0f2f5;
            border: 2px solid #e4e6eb;
            border-radius: 10px;
            text-align: left;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            color: #050505;
            font-weight: 500;
        }

        .option-btn:hover {
            background-color: #e7f3ff;
            border-color: #0084ff;
        }

        .option-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Enhanced Feedback Overlay */
        .feedback-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            z-index: 100;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            color: white;
            width: 80%;
            backdrop-filter: blur(5px);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popUp {
            from { transform: translate(-50%, -40%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .feedback-title {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        .feedback-text {
            font-size: 16px;
            line-height: 1.4;
        }

        .continue-hint {
            margin-top: 15px;
            font-size: 12px;
            opacity: 0.8;
            font-weight: normal;
        }

        /* Result Screen */
        .result-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 30px;
            background: white;
            z-index: 20;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #0084ff;
            margin: 20px 0;
        }

        .result-text {
            font-size: 16px;
            color: #65676b;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .retry-btn {
            background-color: #0084ff;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,132,255,0.3);
            transition: transform 0.2s;
        }
    </style>
</head>
<body>

<div class="phone-container">
    <div class="header">
        <div>HKCV Mall Inbox ğŸ›ï¸</div>
        <div style="font-size: 0.8em;" id="levelIndicator">1/10</div>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar-fill" id="progressBar"></div>
    </div>

    <div class="chat-area" id="chatArea">
        <div class="message customer">System: Welcome back, Amy.<br>Generating 10 random customer enquiries...</div>
    </div>

    <div class="controls" id="controls">
        <p style="margin: 0 0 10px; font-size: 0.8rem; color: #65676b; font-weight: bold;">Select the best reply:</p>
        <div id="options-container">
            </div>
    </div>

    <div class="feedback-overlay" id="feedback">
        <span class="feedback-title" id="feedback-icon"></span>
        <div class="feedback-text" id="feedback-msg"></div>
        <div class="continue-hint">(Wait for next question...)</div>
    </div>

    <div class="result-screen" id="resultScreen">
        <h1 id="resultTitle">Training Complete</h1>
        <div class="result-score" id="finalScore">0/10</div>
        <p class="result-text" id="resultComment">Loading...</p>
        <button class="retry-btn" onclick="location.reload()">New Questions ğŸ”„</button>
    </div>

</div>

<script>
    /* TEACHER NOTE: 
       Each option now has a 'feedback' property.
       This explains WHY the answer is right or wrong.
    */
    const questionPool = [
        // --- GREETING & FORMALITY ---
        {
            customerMsg: "Hi! I want to ask about the Smart Watch.",
            answers: [
                { text: "Dear Sir/Madam, We acknowledge your request.", correct: false, feedback: "Too Formal! ğŸ¤–<br>On social media, 'Dear Sir/Madam' sounds robotic." },
                { text: "What do you want to know?", correct: false, feedback: "Too Blunt! ğŸ˜ <br>This sounds rude. Use polite opening phrases." },
                { text: "Hi there! Sure, how can I help you with the Smart Watch? ğŸ‘‹", correct: true, feedback: "Perfect! ğŸŒŸ<br>Friendly and professional tone." }
            ]
        },
        {
            customerMsg: "Hello HKCV Mall.",
            answers: [
                { text: "Who are you?", correct: false, feedback: "Rude! âŒ<br>Never ask a customer 'Who are you?' directly." },
                { text: "Hi! How may I assist you today? ğŸ˜Š", correct: true, feedback: "Correct! âœ…<br>Standard polite opening for enquiries." },
                { text: "We are open.", correct: false, feedback: "Irrelevant ğŸ¤·<br>The customer hasn't asked if you are open yet." }
            ]
        },
        // --- STOCK AVAILABILITY ---
        {
            customerMsg: "Is the Blue Yoga Mat in stock?",
            answers: [
                { text: "No stock.", correct: false, feedback: "Too Short! ğŸ“‰<br>Incomplete sentence. Try to be more helpful." },
                { text: "Sorry, the blue one is sold out. Would you like the Purple one instead?", correct: true, feedback: "Great Job! ğŸŒŸ<br>You offered an alternative (Purple) to save the sale." },
                { text: "You can buy the Purple one.", correct: false, feedback: "Too Pushy âœ‹<br>Don't command the customer. Ask them nicely." }
            ]
        },
        {
            customerMsg: "Can I buy 50 units of the portable fan?",
            answers: [
                { text: "That is too many.", correct: false, feedback: "Unprofessional âŒ<br>Never reject a big order like this." },
                { text: "Please contact our wholesale department for bulk orders. ğŸ“¦", correct: true, feedback: "Correct! âœ…<br>Directing large orders to the right department." },
                { text: "We don't have enough.", correct: false, feedback: "Weak ğŸ‘<br>Don't just say 'no'. Offer a solution." }
            ]
        },
        // --- PRODUCT FEATURES ---
        {
            customerMsg: "Is this toaster safe for kids?",
            answers: [
                { text: "Yes, it is child-proof and the outside stays cool. ğŸ", correct: true, feedback: "Excellent! ğŸŒŸ<br>You highlighted the benefit 'child-proof'." },
                { text: "Don't let them touch it.", correct: false, feedback: "Warning âš ï¸<br>This is a safety warning, not a product feature." },
                { text: "It is very hot.", correct: false, feedback: "Negative ğŸ“‰<br>Don't scare the customer away." }
            ]
        },
        {
            customerMsg: "Is the blender heavy?",
            answers: [
                { text: "It is lightweight and easy to store.", correct: true, feedback: "Correct! âœ…<br>'Lightweight' is the positive adjective we want." },
                { text: "It is not heavy.", correct: false, feedback: "Too Simple ğŸ˜<br>Try to use better vocabulary like 'Lightweight'." },
                { text: "The weight is acceptable.", correct: false, feedback: "Vague ğŸŒ«ï¸<br>'Acceptable' doesn't sound very attractive." }
            ]
        },
        {
            customerMsg: "Does the skincare set expire soon?",
            answers: [
                { text: "No, it is long-lasting.", correct: false, feedback: "Wrong Word ğŸ“–<br>'Long-lasting' usually describes makeup wear or batteries, not expiry." },
                { text: "It has a shelf life of 2 years. ğŸ§´", correct: true, feedback: "Perfect! ğŸŒŸ<br>'Shelf life' is the correct term for expiry duration." },
                { text: "Maybe next year.", correct: false, feedback: "Guessing? âŒ<br>Never guess. Be precise with dates." }
            ]
        },
        {
            customerMsg: "Is this keyboard wireless?",
            answers: [
                { text: "Yes, no wire.", correct: false, feedback: "Chinglish ğŸ‡­ğŸ‡°<br>The correct term is 'Wireless' or 'Cordless'." },
                { text: "Yes, it connects via Bluetooth for a hassle-free experience. âŒ¨ï¸", correct: true, feedback: "Great! ğŸŒŸ<br>You mentioned the feature (Bluetooth) and benefit (Hassle-free)." },
                { text: "It is wire-free.", correct: false, feedback: "Odd Phrasing ğŸ¤¨<br>'Wire-free' is rarely used for keyboards." }
            ]
        },
        // --- LOCATION & PREPOSITIONS ---
        {
            customerMsg: "Where is your shop?",
            answers: [
                { text: "We are located at 15 Nathan Road.", correct: true, feedback: "Correct! âœ…<br>We use 'AT' for specific addresses/street numbers." },
                { text: "We are located on 15 Nathan Road.", correct: false, feedback: "Grammar Mistake âŒ<br>Use 'AT' for specific numbers, 'ON' for just the road name." },
                { text: "We are in 15 Nathan Road.", correct: false, feedback: "Grammar Mistake âŒ<br>Use 'AT' for addresses." }
            ]
        },
        {
            customerMsg: "Which district are you in?",
            answers: [
                { text: "We are located at Mong Kok.", correct: false, feedback: "Grammar Mistake âŒ<br>Use 'IN' for districts/areas." },
                { text: "We are located in Mong Kok.", correct: true, feedback: "Correct! âœ…<br>We use 'IN' for districts (e.g., In Mong Kok, In Shatin)." },
                { text: "Go to Mong Kok.", correct: false, feedback: "Rude ğŸ˜ <br>This sounds like an order." }
            ]
        },
        // --- NEGATIVE NEWS & SOFTENERS ---
        {
            customerMsg: "Can you give me a free gift?",
            answers: [
                { text: "No, we don't do that.", correct: false, feedback: "Too Direct ğŸ›‘<br>It sounds unfriendly." },
                { text: "I am afraid we do not have any free gifts at the moment. ğŸ™", correct: true, feedback: "Excellent! ğŸŒŸ<br>'I am afraid' softens the refusal politely." },
                { text: "You need to pay for gifts.", correct: false, feedback: "Rude âŒ<br>Don't lecture the customer on money." }
            ]
        },
        {
            customerMsg: "Can I return this used lipstick?",
            answers: [
                { text: "Unfortunately, for hygiene reasons, we cannot accept returns.", correct: true, feedback: "Correct! âœ…<br>You explained the reason (hygiene) politely." },
                { text: "No, you used it already.", correct: false, feedback: "Accusatory ğŸ‘ˆ<br>Don't blame the customer directly." },
                { text: "We regret to reject your request.", correct: false, feedback: "Too Robotic ğŸ¤–<br>This sounds like a legal letter, not a chat." }
            ]
        },
        // --- GRAMMAR (PASSIVE VOICE / COMPLEX SENTENCES) ---
        {
            customerMsg: "Do I get a warranty?",
            answers: [
                { text: "A 1-year warranty is included with your purchase. ğŸ›¡ï¸", correct: true, feedback: "Correct! âœ…<br>Using Passive Voice focuses on the service (Warranty)." },
                { text: "We give you 1 year warranty.", correct: false, feedback: "Too Informal ğŸ’¬<br>Active voice is okay, but Passive is more professional here." },
                { text: "Warranty have 1 year.", correct: false, feedback: "Grammar Error âŒ<br>'Warranty have' is incorrect. Use 'comes with' or 'includes'." }
            ]
        },
        {
            customerMsg: "Why does the bag have this strap?",
            answers: [
                { text: "It is for carrying.", correct: false, feedback: "Too Simple ğŸ“‰<br>Explain the benefit clearly." },
                { text: "The strap is adjustable so that you can wear it comfortably.", correct: true, feedback: "Great! ğŸŒŸ<br>You used 'so that' to connect the feature to the benefit." },
                { text: "Because to carry it.", correct: false, feedback: "Grammar Error âŒ<br>Incorrect sentence structure." }
            ]
        },
        // --- ANGRY CUSTOMERS ---
        {
            customerMsg: "The delivery is LATE! I am angry! ğŸ˜¡",
            answers: [
                { text: "Please calm down.", correct: false, feedback: "Trigger Phrase! ğŸ’£<br>Never tell an angry person to calm down." },
                { text: "It is the courier's fault.", correct: false, feedback: "Blaming Others ğŸ‘ˆ<br>Don't shift the blame. Take responsibility." },
                { text: "I apologize for the delay. Let me track it for you. ğŸšš", correct: true, feedback: "Perfect! ğŸŒŸ<br>Apologize and offer an immediate action." }
            ]
        },
        {
            customerMsg: "This product is broken!",
            answers: [
                { text: "You must have broken it.", correct: false, feedback: "Accusatory âŒ<br>Never accuse the customer of breaking it." },
                { text: "Please send us a photo so we can assist you. ğŸ“¸", correct: true, feedback: "Correct! âœ…<br>Asking for evidence politely to solve the problem." },
                { text: "Buy a new one.", correct: false, feedback: "Rude! ğŸ˜ <br>You will lose the customer forever." }
            ]
        },
        // --- PAYMENT & HOURS ---
        {
            customerMsg: "Do you take credit cards?",
            answers: [
                { text: "Yes, give me your card number.", correct: false, feedback: "Unsecure! ğŸ”“<br>Never ask for card details in a chat." },
                { text: "We accept Visa, Mastercard, and PayMe.", correct: true, feedback: "Correct! âœ…<br>List the payment methods clearly." },
                { text: "Cash only.", correct: false, feedback: "Unlikely ğŸ¤·<br>Online shops usually don't take cash." }
            ]
        },
        {
            customerMsg: "Are you open now? It is midnight.",
            answers: [
                { text: "We are closed. Go to sleep.", correct: false, feedback: "Very Rude ğŸ˜´<br>Avoid personal comments." },
                { text: "Our business hours are 10am to 8pm. Please leave a message! ğŸŒ™", correct: true, feedback: "Correct! âœ…<br>State the hours and encourage a message." },
                { text: "No one is here.", correct: false, feedback: "Unprofessional âŒ<br>Sounds like a ghost town." }
            ]
        },
        // --- VARIETY ---
        {
            customerMsg: "How long does charging take?",
            answers: [
                { text: "It takes about 2 hours to fully charge. ğŸ”‹", correct: true, feedback: "Correct! âœ…<br>Clear and complete sentence." },
                { text: "Wait 2 hours.", correct: false, feedback: "Imperative ğŸ˜ <br>Don't order the customer to wait." },
                { text: "Charging needs 2 hours.", correct: false, feedback: "Chinglish ğŸ‡­ğŸ‡°<br>Better to say 'It takes...'." }
            ]
        },
        {
            customerMsg: "Is the Coffee Machine complicated?",
            answers: [
                { text: "Yes, it is very hard.", correct: false, feedback: "Negative âŒ<br>Don't discourage the buyer." },
                { text: "No, it features a user-friendly interface. â˜•", correct: true, feedback: "Excellent! ğŸŒŸ<br>'User-friendly' is a key vocabulary word." },
                { text: "It is easy.", correct: false, feedback: "Okay... ğŸ˜<br>But 'User-friendly' is much better." }
            ]
        },
        {
            customerMsg: "Can I get a discount code?",
            answers: [
                { text: "Use code HKCV10 for 10% off! ğŸ‰", correct: true, feedback: "Correct! âœ…<br>Encourages the purchase." },
                { text: "No discount for you.", correct: false, feedback: "Rude ğŸ˜ <br>Sounds personal and mean." },
                { text: "We seldom give discounts.", correct: false, feedback: "Negative ğŸ“‰<br>Makes the shop sound stingy." }
            ]
        },
        {
            customerMsg: "The user manual is missing.",
            answers: [
                { text: "Check the box again.", correct: false, feedback: "Bossy ğŸ‘ˆ<br>Don't assume the customer is blind." },
                { text: "You can download the PDF version from our website. ğŸ“„", correct: true, feedback: "Helpful! ğŸŒŸ<br>Providing an immediate solution." },
                { text: "I will send it later.", correct: false, feedback: "Vague ğŸŒ«ï¸<br>Give a specific time or method." }
            ]
        },
        {
            customerMsg: "Is this backpack waterproof?",
            answers: [
                { text: "It is water-resistant, suitable for light rain. â˜”", correct: true, feedback: "Precise! ğŸ¯<br>'Water-resistant' is more accurate than 'proof'." },
                { text: "Yes, water cannot go inside.", correct: false, feedback: "Clumsy ğŸ¥´<br>Poor sentence structure." },
                { text: "It is water-proof.", correct: false, feedback: "Inaccurate âš ï¸<br>Few bags are 100% water-PROOF." }
            ]
        },
        {
            customerMsg: "How do I become a member?",
            answers: [
                { text: "You can register on our website for free. ğŸ’»", correct: true, feedback: "Correct! âœ…<br>Clear instruction." },
                { text: "Join our club.", correct: false, feedback: "Too Casual ğŸˆ<br>'Register' sounds more professional." },
                { text: "Give me your name.", correct: false, feedback: "Too Direct ğŸ›‘<br>Asking for info without explaining why." }
            ]
        },
        {
            customerMsg: "I want to complain about the staff.",
            answers: [
                { text: "Who?", correct: false, feedback: "Too Short ğŸ˜ <br>Sounds aggressive." },
                { text: "We take this seriously. Please tell us more details.", correct: true, feedback: "Professional ğŸŒŸ<br>Acknowledging the severity of the issue." },
                { text: "Our staff is good.", correct: false, feedback: "Defensive ğŸ›¡ï¸<br>Don't argue with a customer immediately." }
            ]
        },
        {
            customerMsg: "Love your products! They are great.",
            answers: [
                { text: "I know.", correct: false, feedback: "Arrogant ğŸ˜<br>Too proud." },
                { text: "Thank you for your support! â¤ï¸", correct: true, feedback: "Perfect! ğŸŒŸ<br>Always thank the customer for praise." },
                { text: "Buy more then.", correct: false, feedback: "Greedy ğŸ’°<br>Ruins the nice moment." }
            ]
        },
        {
            customerMsg: "Do you ship to Macau?",
            answers: [
                { text: "Yes, we provide shipping to Macau via SF Express. ğŸš¢", correct: true, feedback: "Correct! âœ…<br>Formal and informative." },
                { text: "Yes, we send to Macau.", correct: false, feedback: "Informal ğŸ’¬<br>'Provide shipping' is better." },
                { text: "Macau can.", correct: false, feedback: "Chinglish ğŸ‡­ğŸ‡°<br>Incomplete grammar." }
            ]
        },
        {
            customerMsg: "Can I reserve this jacket?",
            answers: [
                { text: "We can hold it for you for 24 hours. ğŸ§¥", correct: true, feedback: "Correct! âœ…<br>'Hold' is the common term for reservation." },
                { text: "Don't buy it yet.", correct: false, feedback: "Confusing ğŸ˜µ<br>Why tell them not to buy?" },
                { text: "Reservation is permitted.", correct: false, feedback: "Too Formal ğŸ¤–<br>Sounds like a rulebook." }
            ]
        },
        {
            customerMsg: "Is the material durable?",
            answers: [
                { text: "It is made of cheap plastic.", correct: false, feedback: "Negative ğŸ“‰<br>Never call your own product 'cheap'." },
                { text: "Yes, it is made of high-quality nylon.", correct: true, feedback: "Correct! âœ…<br>Highlight the quality material." },
                { text: "It lasts long time.", correct: false, feedback: "Grammar Mistake âŒ<br>Should be 'It lasts FOR A long time'." }
            ]
        },
        {
            customerMsg: "My size is wrong. Can I exchange?",
            answers: [
                { text: "You bought the wrong size.", correct: false, feedback: "Blaming ğŸ‘ˆ<br>Avoid 'You' statements when pointing out errors." },
                { text: "Yes, exchanges are allowed within 7 days. ğŸ”„", correct: true, feedback: "Correct! âœ…<br>Stating policy clearly." },
                { text: "Change is okay.", correct: false, feedback: "Vague ğŸŒ«ï¸<br>'Exchange' is the proper business term." }
            ]
        }
    ];

    // Game Variables
    let gameQuestions = [];
    let currentQIndex = 0;
    let score = 0;
    let isWaiting = false;
    
    // DOM Elements
    const chatArea = document.getElementById('chatArea');
    const optionsContainer = document.getElementById('options-container');
    const feedbackOverlay = document.getElementById('feedback');
    const feedbackIcon = document.getElementById('feedback-icon');
    const feedbackMsg = document.getElementById('feedback-msg');
    const levelIndicator = document.getElementById('levelIndicator');
    const progressBar = document.getElementById('progressBar');
    const resultScreen = document.getElementById('resultScreen');
    const finalScoreEl = document.getElementById('finalScore');
    const finalTitle = document.getElementById('resultTitle');
    const finalComment = document.getElementById('resultComment');

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function initGame() {
        const shuffledPool = shuffleArray([...questionPool]);
        gameQuestions = shuffledPool.slice(0, 10);
        currentQIndex = 0;
        score = 0;
        loadQuestion(0);
    }

    function loadQuestion(index) {
        if (index >= gameQuestions.length) {
            showResults();
            return;
        }

        const q = gameQuestions[index];
        levelIndicator.innerText = `${index + 1} / 10`;
        progressBar.style.width = `${(index / 10) * 100}%`;
        isWaiting = false;

        setTimeout(() => {
            addMessage(q.customerMsg, 'customer');
            generateButtons(q);
        }, 400); 
    }

    function generateButtons(q) {
        optionsContainer.innerHTML = '';
        
        // Randomize button order
        let answers = shuffleArray([...q.answers]);

        answers.forEach(ans => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = ans.text;
            btn.onclick = () => handleAnswer(ans, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerHTML = text;
        chatArea.appendChild(div);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    function handleAnswer(answerObj, clickedBtn) {
        if(isWaiting) return;
        isWaiting = true;

        // Visual update
        addMessage(answerObj.text, 'you');
        
        // Disable buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.disabled = true;
            if(b === clickedBtn) {
                 b.style.border = answerObj.correct ? '2px solid #00ff88' : '2px solid #ff4444';
                 b.style.backgroundColor = answerObj.correct ? '#eafff5' : '#ffeaea';
            }
        });

        // Score update
        if (answerObj.correct) score++;

        // Show Enhanced Feedback
        showFeedback(answerObj.feedback, answerObj.correct);

        // Delay for next question
        setTimeout(() =>