<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKCV Mall - CS Random Challenge</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .phone-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 8px solid #333;
            position: relative;
        }

        .header {
            background-color: #0084ff;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 2;
        }

        .progress-bar-container {
            background: #006acc;
            height: 6px;
            width: 100%;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: #00ff88;
            width: 0%;
            transition: width 0.3s ease;
        }

        .chat-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #e4e6eb;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            animation: popIn 0.3s ease-out;
            position: relative;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.customer {
            background-color: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            color: #1c1e21;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message.you {
            background-color: #0084ff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .controls {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #ddd;
            z-index: 2;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 14px;
            margin-bottom: 8px;
            background-color: #f0f2f5;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            text-align: left;
            font-size: 13.5px;
            cursor: pointer;
            transition: all 0.2s;
            color: #050505;
            font-weight: 500;
        }

        .option-btn:hover {
            background-color: #e7f3ff;
            border-color: #0084ff;
        }

        .option-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Feedback Overlay */
        .feedback-overlay {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 25px;
            border-radius: 30px;
            text-align: center;
            z-index: 10;
            display: none;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: fadeInOut 1s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -40%); }
            20% { opacity: 1; transform: translate(-50%, -50%); }
            80% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -60%); }
        }

        /* Result Screen */
        .result-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 30px;
            background: white;
            z-index: 20;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            box-sizing: border-box;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #0084ff;
            margin: 20px 0;
        }

        .result-text {
            font-size: 18px;
            color: #65676b;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .retry-btn {
            background-color: #0084ff;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,132,255,0.3);
            transition: transform 0.2s;
        }

        .retry-btn:hover {
            transform: scale(1.05);
            background-color: #0073e6;
        }
    </style>
</head>
<body>

<div class="phone-container">
    <div class="header">
        <div>HKCV Mall Inbox üõçÔ∏è</div>
        <div style="font-size: 0.8em;" id="levelIndicator">1/10</div>
    </div>
    <div class="progress-bar-container">
        <div class="progress-bar-fill" id="progressBar"></div>
    </div>

    <div class="chat-area" id="chatArea">
        <div class="message customer">System: Welcome back, Amy.<br>Generating 10 random enquiries for you...</div>
    </div>

    <div class="controls" id="controls">
        <p style="margin: 0 0 10px; font-size: 0.8rem; color: #65676b; font-weight: bold;">Select the best reply:</p>
        <div id="options-container">
            </div>
    </div>

    <div class="feedback-overlay" id="feedback"></div>

    <div class="result-screen" id="resultScreen">
        <h1 id="resultTitle">Training Complete</h1>
        <div class="result-score" id="finalScore">0/10</div>
        <p class="result-text" id="resultComment">Loading result...</p>
        <button class="retry-btn" onclick="location.reload()">New Set of Questions üîÑ</button>
    </div>

</div>

<script>
    // --- FULL DATABASE OF 20 QUESTIONS ---
    const questionPool = [
        // --- EXISTING 10 QUESTIONS ---
        {
            customerMsg: "Hi there! I have a question about the Pina V34 hairdryer.",
            options: [
                "Dear Valued Customer, We acknowledge receipt of your message.", 
                "What do you want?", 
                "Hi! Thanks for your message. How can I help you with the Pina V34? üëã" 
            ],
            correct: 2
        },
        {
            customerMsg: "Is the white one in stock?",
            options: [
                "No. Sold out.", 
                "We regret to inform you that the white model is currently unavailable. Pink is available.", 
                "I don't know. Check the website." 
            ],
            correct: 1
        },
        {
            customerMsg: "Is this neck massager heavy? I want to take it on a plane.",
            options: [
                "It is very heavy so it is stable.", 
                "No, it features a lightweight and compact design, ideal for travelling! ‚úàÔ∏è", 
                "It has a built-in heat therapy function." 
            ],
            correct: 1
        },
        {
            customerMsg: "Where can I find your physical shop?",
            options: [
                "We are located at Mong Kok.", 
                "We are located in the Argyle Centre.", 
                "Go to Mong Kok MTR." 
            ],
            correct: 1
        },
        {
            customerMsg: "Do you accept PayMe? I don't have a credit card.",
            options: [
                "Yes, we accept various payment methods, including PayMe and Alipay.", 
                "Yes, send me cash.", 
                "We only accept credit cards." 
            ],
            correct: 0
        },
        {
            customerMsg: "My order is LATE! This is unacceptable! üò°",
            options: [
                "Please calm down.", 
                "It's not our fault. The courier is slow.", 
                "I apologize for the delay. Let me check the status for you immediately. üôè" 
            ],
            correct: 2
        },
        {
            customerMsg: "I want to ask about the warranty.",
            options: [
                "Sure, what do you want to ask?", 
                "Please feel free to make an enquiry about our warranty terms.", 
                "You can ask whatever." 
            ],
            correct: 1
        },
        {
            customerMsg: "Okay, thanks for the info.",
            options: [
                "Bye.", 
                "You're welcome. Please feel free to contact us if you need further assistance.", 
                "Yours sincerely, Amy." 
            ],
            correct: 1
        },
        {
            customerMsg: "Does the massager come with a bag?",
            options: [
                "A carrying case is included for free. üëú", 
                "We give you a bag.", 
                "Bag included." 
            ],
            correct: 0
        },
        {
            customerMsg: "Why should I buy this stand?",
            options: [
                "It is good. It holds your tablet.", 
                "The case can be converted into a stand so that you can attend meetings hands-free.", 
                "Because it is foldable." 
            ],
            correct: 1
        },

        // --- NEW QUESTIONS (11-20) FROM PPT UNIT 1 & 2 ---
        
        // Q11: Unit 2 - Vocab (Adjectives)
        {
            customerMsg: "Is this water bottle easy to break? I have kids.",
            options: [
                "Don't drop it.", 
                "It is made of glass.", 
                "Not at all. It is durable and child-proof. üõ°Ô∏è" 
            ],
            correct: 2,
            note: "Durable means long-lasting. Child-proof means safe for kids."
        },
        // Q12: Unit 1 - Location Preposition (On a street)
        {
            customerMsg: "I am driving. Which street is your shop on?",
            options: [
                "We are located in Nathan Road.", 
                "We are located on Nathan Road.", 
                "We are located at Nathan Road." 
            ],
            correct: 1,
            note: "We use 'ON' for streets/roads (e.g., on Nathan Road)."
        },
        // Q13: Unit 2 - Formality (Opening)
        {
            customerMsg: "Hello HKCV Mall.",
            options: [
                "Hi there! How may I assist you today?", 
                "What?", 
                "Dear Sir/Madam, we acknowledge your presence." 
            ],
            correct: 0,
            note: "Standard polite opening for social media."
        },
        // Q14: Unit 2 - Complex Sentence (so that)
        {
            customerMsg: "Why does the fan have a clip?",
            options: [
                "It has a clip so that you can attach it to your desk.", 
                "It has a clip because it is small.", 
                "The clip is for clipping." 
            ],
            correct: 0,
            note: "Using 'so that' to explain the purpose/benefit."
        },
        // Q15: Unit 1 - Business Hours
        {
            customerMsg: "Are you open right now? It's 9 PM.",
            options: [
                "No. Go away.", 
                "We are closed.", 
                "Our business hours are from 10:00 am to 8:00 pm. Please leave a message! üåô" 
            ],
            correct: 2,
            note: "Polite way to state business hours."
        },
        // Q16: Unit 2 - Negative News (Softener)
        {
            customerMsg: "Can you give me a 50% discount?",
            options: [
                "No way.", 
                "I am afraid we cannot offer such a large discount.", 
                "You are too greedy." 
            ],
            correct: 1,
            note: "Use 'I am afraid...' to soften a refusal."
        },
        // Q17: Unit 2 - Vocab (Ergonomic)
        {
            customerMsg: "Will this mouse hurt my hand if I use it all day?",
            options: [
                "It is an ergonomic design to provide comfort. üñ±Ô∏è", 
                "Yes, it might hurt.", 
                "It is a mouse." 
            ],
            correct: 0,
            note: "Ergonomic = designed for comfort and efficiency."
        },
        // Q18: Unit 1 - Goodwill (Closing)
        {
            customerMsg: "I will order one now. Thanks!",
            options: [
                "Ok.", 
                "We look forward to receiving your order. Thank you for your support! üåü", 
                "Yours faithfully." 
            ],
            correct: 1,
            note: "Expressing goodwill to the customer."
        },
        // Q19: Unit 2 - Passive Voice
        {
            customerMsg: "Do I need to pay for shipping?",
            options: [
                "You must pay.", 
                "Free shipping is provided for orders over $500. üöö", 
                "We give shipping." 
            ],
            correct: 1,
            note: "Passive voice (is provided) sounds more professional."
        },
        // Q20: Unit 2 - Features (Wireless)
        {
            customerMsg: "Does the earphone have a wire?",
            options: [
                "No, it is a wireless device. üéß", 
                "Yes, no wire.", 
                "It is wire-free so that no wire." 
            ],
            correct: 0,
            note: "Correct terminology is 'wireless'."
        }
    ];

    // Game Variables
    let gameQuestions = [];
    let currentQIndex = 0;
    let score = 0;
    
    // DOM Elements
    const chatArea = document.getElementById('chatArea');
    const optionsContainer = document.getElementById('options-container');
    const feedbackOverlay = document.getElementById('feedback');
    const levelIndicator = document.getElementById('levelIndicator');
    const progressBar = document.getElementById('progressBar');
    const resultScreen = document.getElementById('resultScreen');
    const finalScoreEl = document.getElementById('finalScore');
    const finalTitle = document.getElementById('resultTitle');
    const finalComment = document.getElementById('resultComment');

    // --- SHUFFLE FUNCTION (Fisher-Yates) ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function initGame() {
        // 1. Shuffle the full pool
        const shuffledPool = shuffleArray([...questionPool]); // Create a copy to shuffle
        // 2. Take the first 10
        gameQuestions = shuffledPool.slice(0, 10);
        
        currentQIndex = 0;
        score = 0;
        loadQuestion(0);
    }

    function loadQuestion(index) {
        if (index >= gameQuestions.length) {
            showResults();
            return;
        }

        const q = gameQuestions[index];
        levelIndicator.innerText = `${index + 1} / ${gameQuestions.length}`;
        progressBar.style.width = `${(index / gameQuestions.length) * 100}%`;

        // Add Customer Message
        setTimeout(() => {
            addMessage(q.customerMsg, 'customer');
            generateButtons(q, index);
        }, 500); // Slight delay for realism
    }

    function generateButtons(q, index) {
        optionsContainer.innerHTML = '';
        
        // Randomize button order too!
        let choices = q.options.map((text, i) => ({ text, originalIndex: i }));
        choices = shuffleArray(choices);

        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = choice.text;
            btn.onclick = () => handleAnswer(index, choice.originalIndex, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerHTML = text;
        chatArea.appendChild(div);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    function handleAnswer(qIndex, choiceIndex, clickedBtn) {
        const q = gameQuestions[qIndex];
        const isCorrect = (choiceIndex === q.correct);

        // Disable all buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        // Show user reply
        addMessage(q.options[choiceIndex], 'you');

        // Feedback
        if (isCorrect) {
            score++;
            showFeedback("Correct! ‚úÖ", true);
        } else {
            showFeedback("Wrong ‚ùå", false);
        }

        // Delay for next question
        setTimeout(() => {
            currentQIndex++;
            loadQuestion(currentQIndex);
        }, 1500);
    }

    function showFeedback(text, isGood) {
        feedbackOverlay.innerText = text;
        feedbackOverlay.style.display = 'block';
        feedbackOverlay.style.background = isGood ? 'rgba(0,180,0,0.9)' : 'rgba(220,50,50,0.9)';
        
        setTimeout(() => {
            feedbackOverlay.style.display = 'none';
        }, 1200);
    }

    function showResults() {
        document.querySelector('.header').style.display = 'none';
        document.querySelector('.controls').style.display = 'none';
        chatArea.style.display = 'none';
        
        resultScreen.style.display = 'flex';
        
        finalScoreEl.innerText = `${score} / 10`;

        if (score === 10) {
            finalTitle.innerText = "Perfect Score! üèÜ";
            finalComment.innerText = "Outstanding! You are ready for the workplace.";
        } else if (score >= 7) {
            finalTitle.innerText = "Great Job! üëç";
            finalComment.innerText = "You passed the test. Keep refining your tone.";
        } else {
            finalTitle.innerText = "Keep Practising üí™";
            finalComment.innerText = "Review the materials on Formality and Vocabulary.";
        }
    }

    // Start Game
    initGame();

</script>

</body>
</html>