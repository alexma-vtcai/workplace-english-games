<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Service Challenge</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .phone-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 8px solid #333;
        }

        .header {
            background-color: #0084ff;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .satisfaction-bar {
            height: 5px;
            background-color: rgba(255,255,255,0.3);
            width: 100%;
            margin-top: 5px;
            border-radius: 3px;
        }

        .satisfaction-fill {
            height: 100%;
            background-color: #00ff88;
            width: 50%; /* Starting happiness */
            transition: width 0.5s ease;
        }

        .chat-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #e4e6eb;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.customer {
            background-color: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            color: #333;
        }

        .message.you {
            background-color: #0084ff;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .controls {
            padding: 15px;
            background-color: white;
            border-top: 1px solid #ddd;
        }

        .option-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 8px;
            background-color: #f0f2f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: left;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .option-btn:hover {
            background-color: #e4e6eb;
            border-color: #ccc;
        }

        .option-btn:active {
            transform: scale(0.98);
        }

        .hidden { display: none; }
        
        .feedback-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 10;
            display: none;
        }

        /* Result Screen */
        .result-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .restart-btn {
            background-color: #0084ff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

    </style>
</head>
<body>

<div class="phone-container">
    <div class="header">
        <div>Shop Chat ðŸ’¬</div>
        <div style="font-size: 0.8em;">Customer Happiness</div>
    </div>
    <div style="background: #0084ff; padding: 0 15px 10px;">
        <div class="satisfaction-bar"><div class="satisfaction-fill" id="healthBar"></div></div>
    </div>

    <div class="chat-area" id="chatArea">
        <div class="message customer">Hi, I'm interested in the Nike sneakers in your post.</div>
    </div>

    <div class="controls" id="controls">
        <p style="margin: 0 0 10px; font-size: 0.8rem; color: #666;">Choose the best reply:</p>
        <div id="options-container">
            </div>
    </div>

    <div class="result-screen" id="resultScreen">
        <h2 id="finalTitle">Game Over</h2>
        <p id="finalScore">Score: 0</p>
        <button class="restart-btn" onclick="location.reload()">Play Again</button>
    </div>

    <div class="feedback-overlay" id="feedback"></div>

</div>

<script>
    // --- è€å¸«å¯ä»¥åœ¨é€™è£¡ä¿®æ”¹é¡Œç›® (Scenarios) ---
    const scenarios = [
        {
            customerMsg: "Do you have size 10 in stock?",
            options: [
                { text: "No. Sold out.", score: -10, feedback: "Too blunt! (å¤ªç›´æŽ¥ç„¡ç¦®)" },
                { text: "I think so? Let me check later.", score: -5, feedback: "Too vague! (å¤ªå«ç³Š)" },
                { text: "Hi! Let me check the inventory for you right now. ðŸ‘Ÿ", score: 20, feedback: "Perfect! Polite and helpful." }
            ]
        },
        {
            customerMsg: "How much is shipping to Kowloon?",
            options: [
                { text: "It depends.", score: -5, feedback: "Not helpful enough." },
                { text: "Shipping is $30 via SF Express. ðŸšš", score: 20, feedback: "Clear and informative!" },
                { text: "Check the website yourself.", score: -20, feedback: "Rude! You lost a customer." }
            ]
        },
        {
            customerMsg: "My order is LATE! Where is it?? ðŸ˜¡",
            options: [
                { text: "Calm down. It's coming.", score: -20, feedback: "Never tell an angry customer to calm down!" },
                { text: "I apologize for the delay. Let me track it for you immediately. ðŸ™", score: 20, feedback: "Great de-escalation skills!" },
                { text: "Not my fault. The post office is slow.", score: -10, feedback: "Don't shift the blame." }
            ]
        }
    ];

    let currentScenario = 0;
    let happiness = 50; // Starting happiness
    const maxHappiness = 100;

    const chatArea = document.getElementById('chatArea');
    const optionsContainer = document.getElementById('options-container');
    const healthBar = document.getElementById('healthBar');
    const feedbackOverlay = document.getElementById('feedback');
    const controls = document.getElementById('controls');
    const resultScreen = document.getElementById('resultScreen');

    function initGame() {
        loadScenario(0);
    }

    function loadScenario(index) {
        if (index >= scenarios.length) {
            endGame(true);
            return;
        }

        const data = scenarios[index];
        
        // Add Customer Message (except for the first one which is hardcoded in HTML for startup)
        if (index > 0) {
            addMessage(data.customerMsg, 'customer');
        }

        // Generate Buttons
        optionsContainer.innerHTML = '';
        // Randomize options order so answer isn't always C
        let shuffledOptions = [...data.options].sort(() => Math.random() - 0.5);

        shuffledOptions.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            btn.onclick = () => handleChoice(opt, data.options.indexOf(opt)); // pass original index for logic if needed
            optionsContainer.appendChild(btn);
        });

        // Scroll to bottom
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `message ${type}`;
        div.innerText = text;
        chatArea.appendChild(div);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    function handleChoice(option) {
        // 1. Show user's choice in chat
        addMessage(option.text, 'you');

        // 2. Update Happiness
        happiness += option.score;
        if (happiness > maxHappiness) happiness = maxHappiness;
        if (happiness < 0) happiness = 0;
        updateHealthBar();

        // 3. Show Feedback
        showFeedback(option.feedback, option.score > 0);

        // 4. Next Step
        if (happiness <= 0) {
            setTimeout(() => endGame(false), 1500);
        } else {
            currentScenario++;
            setTimeout(() => loadScenario(currentScenario), 1500);
        }
    }

    function showFeedback(text, isGood) {
        feedbackOverlay.innerText = isGood ? "âœ… " + text : "âŒ " + text;
        feedbackOverlay.style.display = 'block';
        feedbackOverlay.style.background = isGood ? 'rgba(0,180,0,0.9)' : 'rgba(200,0,0,0.9)';
        
        setTimeout(() => {
            feedbackOverlay.style.display = 'none';
        }, 1200);
    }

    function updateHealthBar() {
        healthBar.style.width = happiness + '%';
        if(happiness < 30) healthBar.style.backgroundColor = '#ff4444';
        else if(happiness < 70) healthBar.style.backgroundColor = '#ffbb33';
        else healthBar.style.backgroundColor = '#00ff88';
    }

    function endGame(isWin) {
        document.querySelector('.phone-container').style.display = 'none'; // hide phone frame? OR just replace content
        // Let's hide chat and controls, show result
        chatArea.style.display = 'none';
        controls.style.display = 'none';
        document.querySelector('.header').style.display = 'none';
        
        resultScreen.style.display = 'flex';
        
        if (isWin) {
            document.getElementById('finalTitle').innerText = "Job Well Done! ðŸŽ‰";
            document.getElementById('finalScore').innerText = `Final Customer Happiness: ${happiness}%`;
        } else {
            document.getElementById('finalTitle').innerText = "You got Fired... ðŸ˜¢";
            document.getElementById('finalScore').innerText = "The customer was too angry.";
        }
    }

    // Start
    initGame();

</script>

</body>
</html>