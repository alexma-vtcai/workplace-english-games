<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocational English AI Coach (Debug Mode)</title>
    <style>
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background: #f4f6f8; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        
        /* è¨­å®šå€åŸŸ */
        .settings-box { background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffeeba; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 100%; margin-top: 5px; }
        
        .scenario-card { background: #e3f2fd; border-left: 5px solid #2196f3; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        textarea { width: 100%; height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        
        button { border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-submit { background: #28a745; color: white; }
        .btn-submit:hover { background: #218838; }
        .btn-check { background: #17a2b8; color: white; margin-bottom: 10px; }
        
        #status-msg { margin-top: 10px; font-weight: bold; color: #d9534f; text-align: center; }
        #result { margin-top: 20px; padding: 20px; background: #fafafa; border: 1px solid #eee; border-radius: 8px; display: none; white-space: pre-wrap; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h1>è·æ¶¯è‹±èª AI å°å¸« (ä¿®å¾©ç‰ˆ)</h1>

    <div class="settings-box">
        <strong>âš™ï¸ è¨­å®š (Settings)</strong><br>
        <label>é¸æ“‡ AI æ¨¡å‹ (å¦‚æœå ±éŒ¯ï¼Œè«‹æ›ä¸€å€‹è©¦è©¦)ï¼š</label>
        <select id="modelSelect">
            <option value="gemini-1.5-flash-latest">Gemini 1.5 Flash Latest (æ¨è–¦)</option>
            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
            <option value="gemini-1.5-flash-001">Gemini 1.5 Flash-001</option>
            <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
            <option value="gemini-pro">Gemini Pro (èˆŠç‰ˆä½†ç©©å®š)</option>
        </select>
        
        <button class="btn-check" onclick="checkAvailableModels()">ğŸ” æª¢æŸ¥æˆ‘çš„ Key æ”¯æ´ä»€éº¼æ¨¡å‹</button>
        <div id="model-list" style="font-size: 12px; color: #555; margin-top: 5px;"></div>
    </div>

    <div class="scenario-card">
        <strong>ğŸ“Œ ä»»å‹™ï¼šå›è¦†å®¢æˆ¶æŠ•è¨´ (Customer Complaint)</strong>
        <p>æƒ…å¢ƒï¼šå®¢æˆ¶ SunnyB æŠ•è¨´æ²’æ”¶åˆ° 10% æŠ˜æ‰£ã€‚è«‹è§£é‡‹æŠ˜æ‰£åªé©ç”¨æ–¼ 15 äººä»¥ä¸Šåœ˜é«” (Mon-Sat 9am-6pm)ã€‚</p>
    </div>

    <textarea id="studentResponse" placeholder="Type your response here..."></textarea>
    
    <button class="btn-submit" id="submitBtn" onclick="analyzeResponse()">æäº¤ AI æ‰¹æ”¹</button>
    <div id="status-msg"></div>
    <div id="result"></div>
</div>

<script>
    // âš ï¸ è«‹å†æ¬¡ç¢ºèªé€™è£¡å¡«å…¥æ­£ç¢ºçš„ API Key
    const CONFIG_API_KEY = "AIzaSyAoQDlOjh6gxQvYN5pn81hQR0Vjq8qrnUE"; 

    // 1. è¨ºæ–·åŠŸèƒ½ï¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨æ¨¡å‹
    async function checkAvailableModels() {
        const listDiv = document.getElementById('model-list');
        listDiv.innerHTML = "æ­£åœ¨å‘ Google æŸ¥è©¢å¯ç”¨æ¨¡å‹...";
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${CONFIG_API_KEY}`);
            const data = await response.json();
            
            if (data.error) {
                listDiv.innerHTML = `<span style="color:red">éŒ¯èª¤ï¼š${data.error.message}</span>`;
            } else {
                // éæ¿¾å‡º 'generateContent' æ”¯æ´çš„æ¨¡å‹
                const models = data.models
                    .filter(m => m.supportedGenerationMethods.includes("generateContent"))
                    .map(m => m.name.replace("models/", ""))
                    .join(", ");
                
                listDiv.innerHTML = `âœ… ä½ çš„ Key æ”¯æ´é€™äº›æ¨¡å‹ï¼š<br><strong>${models}</strong><br>(è«‹åœ¨ä¸Šæ–¹é¸å–®é¸æ“‡å…¶ä¸­ä¸€å€‹)`;
            }
        } catch (e) {
            listDiv.innerHTML = `<span style="color:red">é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²åŸŸé™åˆ¶æˆ–ç¶²è·¯ã€‚</span>`;
        }
    }

    // 2. ä¸»åŠŸèƒ½ï¼šæ‰¹æ”¹
    async function analyzeResponse() {
        const text = document.getElementById('studentResponse').value;
        const model = document.getElementById('modelSelect').value;
        const btn = document.getElementById('submitBtn');
        const status = document.getElementById('status-msg');
        const resultDiv = document.getElementById('result');

        if (text.length < 5) {
            alert("è«‹è¼¸å…¥å…§å®¹ï¼");
            return;
        }

        btn.disabled = true;
        status.innerText = `æ­£åœ¨ä½¿ç”¨ ${model} æ¨¡å‹åˆ†æä¸­...`;
        resultDiv.style.display = "none";

        // å‹•æ…‹çµ„åˆ URL
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${CONFIG_API_KEY}`;

        const prompt = `
            You are a Vocational English teacher. Analyze this student email:
            """${text}"""
            
            Please provide feedback in Traditional Chinese and English:
            1. Score (0-100)
            2. Grammar & Vocabulary checks
            3. Tone & Professionalism
            4. Consistency check (Discount is for 15+ pax only; Office hours Mon-Sat 9am-6pm).
        `;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }]
                })
            });

            const data = await response.json();

            if (data.error) {
                status.innerText = `âŒ API éŒ¯èª¤ (${model}): ${data.error.message}`;
                if (data.error.message.includes("not found")) {
                    alert("é€™å€‹æ¨¡å‹åç¨±ç„¡æ•ˆï¼Œè«‹åœ¨ä¸Šæ–¹é¸å–®æ›ä¸€å€‹è©¦è©¦ï¼(æ¨è–¦è©¦è©¦ Gemini Pro)");
                }
            } else {
                status.innerText = "";
                let feedback = data.candidates[0].content.parts[0].text;
                // æ ¼å¼åŒ–è¼¸å‡º
                feedback = feedback.replace(/\*\*(.*?)\*\*/g, '<strong style="color:#d35400;">$1</strong>');
                feedback = feedback.replace(/\n/g, '<br>');
                
                resultDiv.innerHTML = feedback;
                resultDiv.style.display = "block";
            }
        } catch (error) {
            status.innerText = "é€£ç·šç™¼ç”ŸéŒ¯èª¤ (å¯èƒ½æ˜¯ç¶²çµ¡æˆ– Key é™åˆ¶)";
            console.error(error);
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>

